---
title: Chapter 3 Concurrent Objects
date: 2020-04-20 15:59:03
tags: Multi-core Concurrent Programming
categories: 课程笔记
mathjax: true
---

# 静态一致性

当一个多线程对象需要呗多个线程同时调用时， 我们很难去定义什么叫做正确的执行。因此我们提出了**静态一致性（Quiescent Consistency）**这个概念。

1. 方法调用是按顺序执行的，每次一个。
2. 被静止状态分割的方法调用应该按照他们被调用的顺序生效

这两条性质决定了在多线程环境中，产生的结果可以通过多个线性的方法调用产生。也就是多线程环境下不能产生单线程环境中无法产生的结果。

具体到行为来说。当给我们一个历史 $H$ 时，如果对被静止状态分割的各个调用的顺序进行重排能够产生合理的结果，那么这个行为就是满足静态一致性的。

<!--more-->

![](/img/quiescent.png)

# 顺序一致性

我们把一个单线程程序产生方法调用的顺序称为**程序顺序（Program Order）**，那么，我们定义**顺序一致性（Sequential Consistency）**为：

1. 方法调用是按顺序执行的，每次一个。
2. 方法调用应当按照程序顺序生效

这一性质决定了在多线程环境下，我们有办法把多线程产生的方法调用排序到一个单线程上，使他们的执行顺序与线程本身的顺序一致.

具体到行为来说。当给我们一个历史 $H$ 时，再不调整各个线程自身调用顺序的前提下对所有线程的调用进行重排，如果能产生合力的结果，那么我们称之为满足顺序一致性。

![](/img/sequential.png)

# 线性一致性（Linearizability）

每个方法调用应该在其调用和响应之间的某个时间点立即生效。

具体行为来说，当给我们一个历史 $H$ 时，当我们只调整相互有重叠的调用之间的顺序，如果能产生合理的结果，那么我们称之为满足线性一致性。线性一致性也被我们称之为**线程安全**。

![](/img/linear.png)

# 正式定义

## 相关概念

- 我们使用history来表示一个并行系统，他是一个有限的包含了方法调用和响应的序列。我们称之为 $H$。
- 一个方法调用可以记作 $<x.m(a^*) A>$， $x$ 是一个对象， $m$ 是一个方法， $a*$ 是参数， $A$ 是一个线程。    
- 一个方法响应记为 $<x:t(r^*) A>$， $t$ 是 ok 或是一个Exception， $r^*$ 是返回值。
- 一个方法调用在 $H$ 中的体现是是一组匹配的方法调用和他的响应。
- 一个方法调用是未完成的，则在 $H$ 中只有调用，没有响应。
- $H$ 的extension指的是为 $H$ 中没有相应的调用添加响应
- $complete(H)$ 指的是去掉所有没有响应调用的 $H$
- $H|A$ 代表 $H$ 中所有和 $A$ 相关的history， $H|x$ 代表 $H$ 中所有和对象 $x$ 有关的
- 如果两个历史被称为等价的，那么对于其中的每一个线程 $A$， $H|A = H|A^\prime$  

## 线性一致性（Linearizability）

一个历史 $H$ 是**可线性化的**，如果 $H$ 的extension $H^\prime$ 存在，并且还存在一个顺序的历史 $S$ 满足：

1. $complete(H^\prime)$ 和 $S$ 是等价的
2. 如果在 $H$ 中调用 $m_0$ 在  $m_1$ 之前，那么在 $S$ 中也一样    

$S$ 被我们成为 $H$ 的一个**线性化(linearization)**

